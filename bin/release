#!/usr/bin/env bash
# bin/release <build-dir>
DEFAULT_WEB_PRE='web: java -Xmx512m -Djetty.port=$PORT -Djetty.home=$JETTY_HOME -Dweb.app='

DEFAULT_WEB_POST=' -jar $JETTY_HOME/start.jar'

DEFAULT_PROCS=""
if [ ! -f "$1/Procfile" ]; then
  WARS=`find $1/target -name *.war | wc -l | tr -s " " | sed 's/^[ ]//g' `
  if [ "$WARS" == "1" ]; then
    WAR=`find $1/target -name *.war`
    DEFAULT_PROCS="
default_process_types:
  \"$DEFAULT_WEB_PRE$WAR$DEFAULT_WEB_POST\""

  fi
fi


cat <<EOF
---
config_vars:
  PATH: .maven/bin:/usr/local/bin:/usr/bin:/bin
  JETTY_HOME: .jetty
  MAVEN_OPTS: -Xmx500m $DEFAULT_PROCS
EOF
